<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ganesh Billing</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Inter,Arial}
body{margin:0;background:#f5f7fb}

/* ---------- LOGIN ---------- */
#loginPage{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.login-card{
  background:#fff;
  padding:30px;
  width:320px;
  border-radius:10px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
}
.login-card h2{text-align:center;margin-bottom:20px}
.login-card input{
  width:100%;
  padding:10px;
  margin-bottom:12px;
}
.login-card button{
  width:100%;
  padding:10px;
  background:#4f46e5;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

/* ---------- DASHBOARD ---------- */
#dashboard{
  display:none;
  height:100vh;
}

/* sidebar */
.sidebar{
  width:220px;
  background:#0f172a;
  color:#fff;
  padding:20px;
}
.sidebar h3{margin-top:0}
.sidebar a{
  display:block;
  color:#cbd5e1;
  padding:10px 0;
  cursor:pointer;
  text-decoration:none;
}
.sidebar a:hover{color:#fff}

/* content */
.content{
  flex:1;
  padding:30px;
  overflow:auto;
}
.section{display:none}
.section.active{display:block}

/* basic form */
input,textarea,select{
  width:100%;
  padding:8px;
  margin-bottom:10px;
}
button.primary{
  background:#4f46e5;
  color:#fff;
  border:none;
  padding:10px 14px;
  border-radius:6px;
  cursor:pointer;
}
button.danger{
  background:#dc2626;
  color:#fff;
  border:none;
  padding:10px 14px;
  border-radius:6px;
}
</style>
</head>

<body>

<!-- ================= LOGIN ================= -->
<div id="loginPage">
  <div class="login-card">
    <h2>Login</h2>
    <input id="loginMobile" placeholder="Mobile Number">
    <input id="loginPassword" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- ================= DASHBOARD ================= -->
<div id="dashboard">
  <div class="sidebar">
    <h3>Ganesh Billing</h3>
    <a onclick="showSection('personal')">Personal Details</a>
    <a onclick="showSection('parties')">Parties</a>
    <a onclick="showSection('items')">Items</a>
    <a onclick="showSection('sales')">Sales</a>
    <a onclick="showSection('settings')">Settings</a>
    <a onclick="logout()">Logout</a>
  </div>

  <div class="content">
    <div id="personal" class="section active">
      <h2>Personal / Business Details</h2>
      <input id="bizName" placeholder="Business Name">
      <input id="bizMobile" placeholder="Mobile">
      <input id="bizGST" placeholder="GST Number">
      <input id="bizEmail" placeholder="Email">
      <textarea id="bizAddress" placeholder="Address"></textarea>
      <button class="primary" onclick="saveProfile()">Save</button>
    </div>

    <div id="parties" class="section">
      <h2>Parties</h2>
      <input id="partyName" placeholder="Party Name">
      <input id="partyMobile" placeholder="Mobile">
      <button class="primary" onclick="addParty()">Add Party</button>
      <ul id="partyList"></ul>
    </div>

    <div id="items" class="section">
      <h2>Items</h2>
      <input id="itemName" placeholder="Item Name">
      <input id="itemPrice" placeholder="Price">
      <button class="primary" onclick="addItem()">Add Item</button>
      <ul id="itemList"></ul>
    </div>

    <div id="sales" class="section">
      <h2>Sales Invoices</h2>
      <input id="invParty" placeholder="Party Name">
      <input id="invAmount" placeholder="Amount">
      <button class="primary" onclick="saveInvoice()">Create Invoice</button>
      <ul id="invoiceList"></ul>
    </div>

    <div id="settings" class="section">
      <h2>Settings</h2>
      <label>Font Size</label>
      <select onchange="document.body.style.fontSize=this.value">
        <option value="14px">Small</option>
        <option value="16px" selected>Normal</option>
        <option value="18px">Large</option>
      </select>
    </div>
  </div>
</div>

<!-- ================= FIREBASE ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, setDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyAY4MfQ5zPh60EfYmY0JoKIDQkojqNU6hs",
  authDomain:"ganeshbilling-bdada.firebaseapp.com",
  projectId:"ganeshbilling-bdada"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
let uid="";

/* ---------- AUTH FLOW ---------- */
onAuthStateChanged(auth,user=>{
  if(user){
    uid=user.uid;
    loginPage.style.display="none";
    dashboard.style.display="flex";
    loadAll();
  }else{
    dashboard.style.display="none";
    loginPage.style.display="flex";
  }
});

window.login=()=>{
  signInWithEmailAndPassword(
    auth,
    loginMobile.value+"@mobile.local",
    loginPassword.value
  );
};

window.logout=()=>signOut(auth);

/* ---------- NAV ---------- */
window.showSection=id=>{
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

/* ---------- DATA ---------- */
async function loadAll(){
  loadParties();
  loadItems();
  loadInvoices();
}

/* profile */
window.saveProfile=async()=>{
  await setDoc(doc(db,"users",uid),{
    name:bizName.value,
    mobile:bizMobile.value,
    gst:bizGST.value,
    email:bizEmail.value,
    address:bizAddress.value
  });
};

/* parties */
window.addParty=async()=>{
  await addDoc(collection(db,"users",uid,"parties"),{
    name:partyName.value,
    mobile:partyMobile.value
  });
  loadParties();
};
async function loadParties(){
  partyList.innerHTML="";
  const snap=await getDocs(collection(db,"users",uid,"parties"));
  snap.forEach(d=>{
    partyList.innerHTML+=`<li>${d.data().name}</li>`;
  });
}

/* items */
window.addItem=async()=>{
  await addDoc(collection(db,"users",uid,"items"),{
    name:itemName.value,
    price:itemPrice.value
  });
  loadItems();
};
async function loadItems(){
  itemList.innerHTML="";
  const snap=await getDocs(collection(db,"users",uid,"items"));
  snap.forEach(d=>{
    itemList.innerHTML+=`<li>${d.data().name}</li>`;
  });
}

/* invoices */
window.saveInvoice=async()=>{
  await addDoc(collection(db,"users",uid,"invoices"),{
    party:invParty.value,
    amount:invAmount.value,
    date:new Date().toLocaleDateString()
  });
  loadInvoices();
};
async function loadInvoices(){
  invoiceList.innerHTML="";
  const snap=await getDocs(collection(db,"users",uid,"invoices"));
  snap.forEach(d=>{
    invoiceList.innerHTML+=`<li>${d.data().party} - â‚¹${d.data().amount}</li>`;
  });
}
</script>
</body>
</html>
