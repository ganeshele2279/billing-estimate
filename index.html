<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ganesh Billing</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f1f5f9}
#loginPage,#dashboardPage{position:fixed;inset:0;display:none}

/* LOGIN */
#loginPage{display:flex;align-items:center;justify-content:center}
.login-box{background:#fff;padding:25px;width:320px;border-radius:8px;box-shadow:0 0 10px #0002}
input,textarea,select{width:100%;padding:10px;margin:6px 0;border:1px solid #ccc;border-radius:4px}
button{padding:8px 12px;border:none;border-radius:4px;cursor:pointer}
.btn-primary{background:#4f46e5;color:#fff}
.btn-danger{background:#dc2626;color:#fff}
.btn-outline{border:1px solid #4f46e5;background:#fff;color:#4f46e5}

/* DASHBOARD */
#dashboardPage{display:flex}
.sidebar{width:230px;background:#0f172a;color:#fff;display:flex;flex-direction:column}
.menu,.submenu{padding:14px;cursor:pointer}
.menu:hover,.submenu:hover,.menu.active,.submenu.active{background:#1e293b}
.submenu{padding-left:30px;font-size:14px}
.profile{margin-top:auto;padding:14px;border-top:1px solid #1e293b}

.main{flex:1;padding:25px;overflow:auto}
.content{display:none;max-width:1200px;margin:auto}
.content.active{display:block}
.card{background:#fff;padding:20px;border-radius:8px;box-shadow:0 0 10px #0001;margin-bottom:20px}
.flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

.table{width:100%;border-collapse:collapse}
.table th,.table td{border:1px solid #ddd;padding:8px}
.table th{background:#f3f4f6}

/* MODAL */
.modal{position:fixed;inset:0;background:#0007;display:none;align-items:center;justify-content:center;z-index:100}
.modal-box{background:#fff;width:950px;max-height:90vh;overflow:auto;border-radius:8px;padding:20px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="login-box">
    <h2>Login</h2>
    <input id="loginMobile" placeholder="Mobile Number">
    <input id="loginPassword" type="password" placeholder="Password">
    <button class="btn-primary" style="width:100%" onclick="login()">Login</button>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboardPage">
  <div class="sidebar">

    <div class="menu active" onclick="showTab('home',this)">üè† Dashboard</div>

    <div class="menu" onclick="toggleMenu('settingsSub','sArrow')">
      ‚öôÔ∏è Settings <span id="sArrow" style="float:right">‚ñ∏</span>
    </div>
    <div id="settingsSub" style="display:none">
      <div class="submenu" onclick="showTab('manageBusiness',this)">Manage Business</div>
      <div class="submenu" onclick="showTab('fontSettings',this)">Font Style</div>
      <div class="submenu" onclick="logout()" style="color:#fca5a5">Logout</div>
    </div>

    <div class="menu" onclick="toggleMenu('salesSub','saleArrow')">
      üßæ Sales <span id="saleArrow" style="float:right">‚ñ∏</span>
    </div>
    <div id="salesSub" style="display:none">
      <div class="submenu" onclick="showTab('salesInvoices',this)">Sales Invoices</div>
    </div>

    <div class="menu" onclick="toggleMenu('itemSub','itemArrow')">
      üì¶ Items <span id="itemArrow" style="float:right">‚ñ∏</span>
    </div>
    <div id="itemSub" style="display:none">
      <div class="submenu" onclick="openItemModal()">Create Item</div>
      <div class="submenu" onclick="showTab('itemsList',this)">Items List</div>
    </div>

    <div class="menu" onclick="showTab('personal',this)">üë§ Personal Details</div>

    <div class="profile">
      <div id="userName">User</div>
      <small>Online</small>
    </div>
  </div>

  <div class="main">

    <div id="home" class="content active">
      <div class="card"><h2>Welcome üëã</h2></div>
    </div>

    <div id="manageBusiness" class="content">
      <h2>Business Settings</h2>
      <div class="card">
        <input id="bizName" placeholder="Business Name">
        <input id="bizPhone" placeholder="Phone">
        <input id="bizEmail" placeholder="Email">
        <textarea id="bizAddress" placeholder="Address"></textarea>
        <button class="btn-primary" onclick="saveBusiness()">Save</button>
      </div>
    </div>

    <div id="fontSettings" class="content">
      <h2>Font Style</h2>
      <div class="card">
        <select onchange="applyFont(this.value)">
          <option value="Arial">Arial</option>
          <option value="Poppins">Poppins</option>
          <option value="Roboto">Roboto</option>
        </select>
        <br><br>
        <label>Font Size</label><br>
        <input type="range" min="12" max="22" value="14" onchange="applyFontSize(this.value)">
        <span id="fontSizeLabel">14px</span>
      </div>
    </div>

    <div id="personal" class="content">
      <div class="card">
        <h2>Personal Details</h2>
        <input id="business" placeholder="Business Name">
        <input id="mobile" placeholder="Mobile">
        <input id="gst" placeholder="GST">
        <input id="email" placeholder="Email">
        <textarea id="address" placeholder="Address"></textarea>
        <button class="btn-primary" onclick="saveProfile()">Save</button>
      </div>
    </div>

    <div id="itemsList" class="content">
      <div class="card">
        <table class="table">
          <thead><tr><th>Name</th><th>Code</th><th>Price</th></tr></thead>
          <tbody id="itemsTable"></tbody>
        </table>
      </div>
    </div>

    <div id="salesInvoices" class="content">
      <div class="card">
        <button class="btn-primary" onclick="openInvoice()">Create Invoice</button>
        <table class="table">
          <thead><tr><th>Date</th><th>Party</th><th>Amount</th><th>Status</th></tr></thead>
          <tbody id="invoiceTable"></tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, setDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyAY4MfQ5zPh60EfYmY0JoKIDQkojqNU6hs",
  authDomain:"ganeshbilling-bdada.firebaseapp.com",
  projectId:"ganeshbilling-bdada"
});
const auth=getAuth(), db=getFirestore();
let uid="";

onAuthStateChanged(auth,user=>{
  if(user){
    uid=user.uid;
    loginPage.style.display="none";
    dashboardPage.style.display="flex";
    loadItems();
    loadInvoices();
  }else{
    loginPage.style.display="flex";
  }
});

window.login=()=>signInWithEmailAndPassword(auth,loginMobile.value+"@mobile.local",loginPassword.value);
window.logout=async()=>{await signOut(auth);location.reload()};

window.toggleMenu=(id,a)=>{
  const e=document.getElementById(id);
  e.style.display=e.style.display==="none"?"block":"none";
  document.getElementById(a).innerText=e.style.display==="none"?"‚ñ∏":"‚ñæ";
};
window.showTab=(id,el)=>{
  document.querySelectorAll(".content").forEach(c=>c.classList.remove("active"));
  document.querySelectorAll(".menu,.submenu").forEach(m=>m.classList.remove("active"));
  el.classList.add("active");
  document.getElementById(id).classList.add("active");
};

window.applyFont=f=>{document.body.style.fontFamily=f;localStorage.setItem("appFont",f)}
window.applyFontSize=s=>{document.body.style.fontSize=s+"px";fontSizeLabel.innerText=s+"px";localStorage.setItem("appFontSize",s)}
const f=localStorage.getItem("appFont"),fs=localStorage.getItem("appFontSize");
if(f)document.body.style.fontFamily=f;
if(fs){document.body.style.fontSize=fs+"px";fontSizeLabel.innerText=fs+"px";}

window.saveProfile=()=>setDoc(doc(db,"profiles",uid),{
  business:business.value,mobile:mobile.value,gst:gst.value,email:email.value,address:address.value
});

async function loadItems(){
  const s=await getDocs(collection(db,"items",uid,"list"));
  itemsTable.innerHTML="";
  s.forEach(d=>{
    const i=d.data();
    itemsTable.innerHTML+=`<tr><td>${i.name}</td><td>${i.code||""}</td><td>${i.salePrice||""}</td></tr>`;
  });
}

async function loadInvoices(){
  const s=await getDocs(collection(db,"sales",uid,"invoices"));
  invoiceTable.innerHTML="";
  s.forEach(d=>{
    const i=d.data();
    invoiceTable.innerHTML+=`<tr><td>${i.date}</td><td>${i.party}</td><td>${i.amount}</td><td>${i.status}</td></tr>`;
  });
}
</script>

</body>
</html>
