<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login | Ganesh Billing</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  margin: 0;
  height: 100vh;
  background: #f4f6f8;
  font-family: Arial, sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
}
.card {
  width: 360px;
  background: #fff;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  text-align: center;
}
h2 { margin-bottom: 20px; }
input {
  width: 100%;
  padding: 12px;
  margin-bottom: 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
}
button {
  width: 100%;
  padding: 12px;
  background: #2563eb;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
.otp-box { display: none; }
.small { font-size: 13px; color: #666; margin-top: 10px; }
</style>
</head>
<body>

<div class="card">
<h2>Login / Register</h2>
<input type="text" id="name" placeholder="Full Name (New User)">
<input type="text" id="phone" placeholder="Mobile Number">
<button onclick="sendOTP()">Send OTP</button>

<div class="otp-box" id="otpBox">
<input type="text" id="otp" placeholder="Enter OTP">
<button onclick="verifyOTP()">Verify & Login</button>
</div>

<div id="recaptcha-container"></div>
<div class="small">Powered by Ganesh Billing</div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAY4MfQ5zPh60EfYmY0JoKIDQkojqNU6hs",
  authDomain: "ganeshbilling-bdada.firebaseapp.com",
  projectId: "ganeshbilling-bdada",
  storageBucket: "ganeshbilling-bdada.firebasestorage.app",
  messagingSenderId: "351410373004",
  appId: "1:351410373004:web:50be765037e463735a16a9"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(
  'recaptcha-container',
  { size: 'normal' }
);

let confirmationResult;

function sendOTP() {
  let phone = document.getElementById("phone").value.trim();

  if (phone.length !== 10) {
    alert("Enter valid 10 digit mobile number");
    return;
  }

  phone = "+91" + phone;

  auth.signInWithPhoneNumber(phone, window.recaptchaVerifier)
    .then(result => {
      confirmationResult = result;
      document.getElementById("otpBox").style.display = "block";
      alert("OTP sent");
    })
    .catch(err => alert(err.message));
}
  
function verifyOTP() {
  const otp = document.getElementById("otp").value;
  const name = document.getElementById("name").value;

  confirmationResult.confirm(otp)
    .then(res => {
      const user = res.user;
      db.collection("users").doc(user.uid).set({
        name: name || "User",
        phone: user.phoneNumber,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true });

      alert("Login Successful");
    })
    .catch(() => alert("Invalid OTP"));
}
</script>

</body>
</html>
