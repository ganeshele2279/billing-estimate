<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ganesh Billing</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f1f5f9}
#loginPage,#dashboardPage{position:fixed;inset:0;display:none}

/* LOGIN */
#loginPage{display:flex;align-items:center;justify-content:center}
.login-box{background:#fff;padding:25px;width:320px;border-radius:8px;box-shadow:0 0 10px #0002}
input,textarea,select{width:100%;padding:10px;margin:6px 0;border:1px solid #ccc;border-radius:4px}
button{padding:8px 12px;border:none;border-radius:4px;cursor:pointer}
.btn-primary{background:#4f46e5;color:#fff}
.btn-danger{background:#dc2626;color:#fff}
.btn-small{padding:5px 8px;font-size:12px}

/* DASHBOARD */
#dashboardPage{display:flex}
.sidebar{width:220px;background:#0f172a;color:#fff;display:flex;flex-direction:column}
.menu{padding:14px;cursor:pointer}
.menu:hover,.menu.active{background:#1e293b}
.submenu{padding:12px 30px;font-size:14px;cursor:pointer}
.submenu:hover,.submenu.active{background:#1e293b}
.profile{margin-top:auto;padding:14px;border-top:1px solid #1e293b}

.main{flex:1;padding:25px;overflow:auto}
.content{max-width:1100px;margin:auto;display:none}
.content.active{display:block}
.card{background:#fff;padding:25px;border-radius:8px;box-shadow:0 0 10px #0001;margin-bottom:20px}

.row{display:flex;gap:15px}
.col{flex:1}

.table{width:100%;border-collapse:collapse}
.table th,.table td{border:1px solid #ddd;padding:8px;font-size:14px}
.table th{background:#f3f4f6}
.flex{display:flex;gap:8px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="login-box">
    <h2>Login</h2>
    <input id="loginMobile" placeholder="Mobile Number">
    <input id="loginPassword" type="password" placeholder="Password">
    <button class="btn-primary" style="width:100%" onclick="login()">Login</button>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboardPage">
  <div class="sidebar">

    <div class="menu active" onclick="showTab('home',this)">üè† Dashboard</div>

    <div class="menu" onclick="toggleParties(this)">
      üë• Parties <span style="float:right" id="partyArrow">‚ñ∏</span>
    </div>
    <div id="partySubMenu" style="display:none">
      <div class="submenu" onclick="showTab('partyAdd',this)">‚ûï Add Party</div>
      <div class="submenu" onclick="showTab('partyEdit',this)">‚úèÔ∏è Edit Party</div>
    </div>

    <div class="menu" onclick="showTab('personal',this)">üë§ Personal Details</div>

    <div class="profile">
      <div id="userName">User</div>
      <small>Online</small>
    </div>
  </div>

  <div class="main">

    <!-- HOME -->
    <div id="home" class="content active">
      <div class="card">
        <h2>Welcome üëã</h2>
        <p>Select option from sidebar.</p>
      </div>
    </div>

    <!-- PERSONAL DETAILS -->
    <div id="personal" class="content">
      <div class="card">
        <h2>Personal / Business Details</h2>
        <input id="business" placeholder="Business Name">
        <input id="mobile" placeholder="Mobile Number">
        <input id="gst" placeholder="GST Number">
        <input id="email" placeholder="Email">
        <textarea id="address" placeholder="Address"></textarea>
        <button class="btn-primary" onclick="saveProfile()">Save</button>
      </div>
    </div>

    <!-- ADD PARTY -->
    <div id="partyAdd" class="content">
      <div class="card">
        <h2>Create Party</h2>

        <h4>General Details</h4>
        <div class="row">
          <div class="col"><input id="pName" placeholder="Party Name *"></div>
          <div class="col"><input id="pMobile" placeholder="Mobile Number"></div>
          <div class="col"><input id="pEmail" placeholder="Email"></div>
          <div class="col"><input id="pOpening" placeholder="‚Çπ Opening Balance"></div>
        </div>

        <div class="row">
          <div class="col"><input id="pGstin" placeholder="GSTIN"></div>
          <div class="col"><input id="pPan" placeholder="PAN Number"></div>
        </div>

        <div class="row">
          <div class="col">
            <select id="pType">
              <option>Customer</option>
              <option>Supplier</option>
            </select>
          </div>
          <div class="col">
            <select id="pCategory">
              <option>Select Category</option>
              <option>Retail</option>
              <option>Wholesale</option>
            </select>
          </div>
        </div>

        <h4>Address</h4>
        <div class="row">
          <div class="col"><textarea id="pBilling" placeholder="Billing Address"></textarea></div>
          <div class="col"><textarea id="pShipping" placeholder="Shipping Address"></textarea></div>
        </div>

        <h4>Credit</h4>
        <div class="row">
          <div class="col"><input id="pCreditPeriod" placeholder="Credit Period (Days)"></div>
          <div class="col"><input id="pCreditLimit" placeholder="‚Çπ Credit Limit"></div>
        </div>

        <button class="btn-primary" onclick="saveParty()">Save Party</button>
      </div>
    </div>

    <!-- EDIT PARTY -->
    <div id="partyEdit" class="content">

      <div class="card">
        <input id="searchParty" placeholder="Search party by name or mobile" onkeyup="filterParties()">
      </div>

      <div class="card">
        <table class="table">
          <thead>
            <tr>
              <th>Name</th><th>Mobile</th><th>Type</th><th>Action</th>
            </tr>
          </thead>
          <tbody id="partyList"></tbody>
        </table>
      </div>

      <div class="card" id="ledgerCard" style="display:none">
        <h3>Party Ledger</h3>
        <table class="table">
          <thead>
            <tr><th>Date</th><th>Description</th><th>Debit</th><th>Credit</th></tr>
          </thead>
          <tbody id="ledgerBody"></tbody>
        </table>
      </div>

    </div>

  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, setDoc } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyAY4MfQ5zPh60EfYmY0JoKIDQkojqNU6hs",
  authDomain:"ganeshbilling-bdada.firebaseapp.com",
  projectId:"ganeshbilling-bdada"
});
const auth=getAuth(), db=getFirestore();
let uid="", allParties=[];

/* AUTH */
onAuthStateChanged(auth,user=>{
  if(user){
    uid=user.uid;
    loginPage.style.display="none";
    dashboardPage.style.display="flex";
    loadParties();
  }else{
    dashboardPage.style.display="none";
    loginPage.style.display="flex";
  }
});

/* LOGIN */
window.login=()=>signInWithEmailAndPassword(auth,loginMobile.value+"@mobile.local",loginPassword.value);

/* SIDEBAR */
window.toggleParties=()=>{
  partySubMenu.style.display = partySubMenu.style.display==="none"?"block":"none";
  partyArrow.innerText = partySubMenu.style.display==="none"?"‚ñ∏":"‚ñæ";
};

window.showTab=(id,el)=>{
  document.querySelectorAll(".content").forEach(c=>c.classList.remove("active"));
  document.querySelectorAll(".menu,.submenu").forEach(m=>m.classList.remove("active"));
  el.classList.add("active");
  document.getElementById(id).classList.add("active");
};

/* PERSONAL */
window.saveProfile=async()=>{
  await setDoc(doc(db,"profiles",uid),{
    business:business.value,mobile:mobile.value,gst:gst.value,email:email.value,address:address.value
  });
  alert("Saved");
};

/* PARTY */
window.saveParty=async()=>{
  await addDoc(collection(db,"parties",uid,"list"),{
    partyName:pName.value,
    mobile:pMobile.value,
    email:pEmail.value,
    openingBalance:pOpening.value,
    gstin:pGstin.value,
    pan:pPan.value,
    partyType:pType.value,
    category:pCategory.value,
    billingAddress:pBilling.value,
    shippingAddress:pShipping.value,
    creditPeriod:pCreditPeriod.value,
    creditLimit:pCreditLimit.value,
    createdAt:new Date()
  });
  alert("Party Saved");
  loadParties();
};

/* LOAD + SEARCH */
async function loadParties(){
  const snap=await getDocs(collection(db,"parties",uid,"list"));
  allParties=[];
  snap.forEach(d=>allParties.push({id:d.id,...d.data()}));
  renderParties(allParties);
}

function renderParties(list){
  partyList.innerHTML="";
  list.forEach(p=>{
    partyList.innerHTML+=`
      <tr>
        <td>${p.partyName}</td>
        <td>${p.mobile||""}</td>
        <td>${p.partyType}</td>
        <td class="flex">
          <button class="btn-small btn-primary" onclick="openLedger('${p.id}')">Ledger</button>
          <button class="btn-small btn-danger" onclick="deleteParty('${p.id}')">Delete</button>
        </td>
      </tr>`;
  });
}

window.filterParties=()=>{
  const q=searchParty.value.toLowerCase();
  renderParties(allParties.filter(p=>p.partyName.toLowerCase().includes(q)||(p.mobile||"").includes(q)));
};

window.deleteParty=async(id)=>{
  if(!confirm("Delete this party?"))return;
  await deleteDoc(doc(db,"parties",uid,"list",id));
  loadParties();
};

window.openLedger=async(pid)=>{
  ledgerBody.innerHTML="";
  ledgerCard.style.display="block";
  const snap=await getDocs(collection(db,"ledgers",uid,pid));
  snap.forEach(d=>{
    const l=d.data();
    ledgerBody.innerHTML+=`<tr><td>${l.date||""}</td><td>${l.description||""}</td><td>${l.debit||""}</td><td>${l.credit||""}</td></tr>`;
  });
};
</script>

</body>
</html>
